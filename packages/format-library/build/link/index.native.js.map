{"version":3,"sources":["@wordpress/format-library/src/link/index.native.js"],"names":["name","link","title","tagName","className","attributes","url","target","edit","arguments","addLink","bind","stopAddingLink","onRemoveFormat","getURLFromClipboard","state","addingLink","props","value","onChange","text","newValue","type","start","end","activeFormats","needsSelectionUpdate","setState","isActive","startFormat","startIndex","endIndex","formats","speak","undefined","linkSelection","getLinkSelection","Clipboard","getString","clipboardText","clipboardURL","activeAttributes","linkIcon","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { find } from 'lodash';\nimport { Clipboard } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { withSpokenMessages } from '@wordpress/components';\nimport { RichTextToolbarButton } from '@wordpress/block-editor';\nimport {\n\tapplyFormat,\n\tgetActiveFormat,\n\tgetTextContent,\n\tisCollapsed,\n\tremoveFormat,\n\tslice,\n} from '@wordpress/rich-text';\nimport { isURL } from '@wordpress/url';\nimport { link as linkIcon } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport ModalLinkUI from './modal';\n\nconst name = 'core/link';\n\nexport const link = {\n\tname,\n\ttitle: __( 'Link' ),\n\ttagName: 'a',\n\tclassName: null,\n\tattributes: {\n\t\turl: 'href',\n\t\ttarget: 'target',\n\t},\n\tedit: withSpokenMessages(\n\t\tclass LinkEdit extends Component {\n\t\t\tconstructor() {\n\t\t\t\tsuper( ...arguments );\n\n\t\t\t\tthis.addLink = this.addLink.bind( this );\n\t\t\t\tthis.stopAddingLink = this.stopAddingLink.bind( this );\n\t\t\t\tthis.onRemoveFormat = this.onRemoveFormat.bind( this );\n\t\t\t\tthis.getURLFromClipboard = this.getURLFromClipboard.bind(\n\t\t\t\t\tthis\n\t\t\t\t);\n\t\t\t\tthis.state = {\n\t\t\t\t\taddingLink: false,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\taddLink() {\n\t\t\t\tconst { value, onChange } = this.props;\n\t\t\t\tconst text = getTextContent( slice( value ) );\n\n\t\t\t\tif ( text && isURL( text ) ) {\n\t\t\t\t\tconst newValue = applyFormat( value, {\n\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\tattributes: { url: text },\n\t\t\t\t\t} );\n\t\t\t\t\tnewValue.start = newValue.end;\n\t\t\t\t\tnewValue.activeFormats = [];\n\t\t\t\t\tonChange( { ...newValue, needsSelectionUpdate: true } );\n\t\t\t\t} else {\n\t\t\t\t\tthis.setState( { addingLink: true } );\n\t\t\t\t\tthis.getURLFromClipboard();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstopAddingLink() {\n\t\t\t\tthis.setState( { addingLink: false } );\n\t\t\t}\n\n\t\t\tgetLinkSelection() {\n\t\t\t\tconst { value, isActive } = this.props;\n\t\t\t\tconst startFormat = getActiveFormat( value, 'core/link' );\n\n\t\t\t\t// if the link isn't selected, get the link manually by looking around the cursor\n\t\t\t\t// TODO: handle partly selected links\n\t\t\t\tif ( startFormat && isCollapsed( value ) && isActive ) {\n\t\t\t\t\tlet startIndex = value.start;\n\t\t\t\t\tlet endIndex = value.end;\n\n\t\t\t\t\twhile ( find( value.formats[ startIndex ], startFormat ) ) {\n\t\t\t\t\t\tstartIndex--;\n\t\t\t\t\t}\n\n\t\t\t\t\tendIndex++;\n\n\t\t\t\t\twhile ( find( value.formats[ endIndex ], startFormat ) ) {\n\t\t\t\t\t\tendIndex++;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...value,\n\t\t\t\t\t\tstart: startIndex + 1,\n\t\t\t\t\t\tend: endIndex,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tonRemoveFormat() {\n\t\t\t\tconst { onChange, speak, value } = this.props;\n\t\t\t\tconst startFormat = getActiveFormat( value, 'core/link' );\n\n\t\t\t\t// Before we try to remove anything we check if there is something at the caret position to remove.\n\t\t\t\tif ( isCollapsed( value ) && startFormat === undefined ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst linkSelection = this.getLinkSelection();\n\n\t\t\t\tonChange( removeFormat( linkSelection, name ) );\n\t\t\t\tspeak( __( 'Link removed.' ), 'assertive' );\n\t\t\t}\n\n\t\t\tasync getURLFromClipboard() {\n\t\t\t\tconst clipboardText = await Clipboard.getString();\n\t\t\t\tif ( ! clipboardText ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Check if pasted text is URL\n\t\t\t\tif ( ! isURL( clipboardText ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.setState( { clipboardURL: clipboardText } );\n\t\t\t}\n\n\t\t\trender() {\n\t\t\t\tconst { isActive, activeAttributes, onChange } = this.props;\n\t\t\t\tconst linkSelection = this.getLinkSelection();\n\t\t\t\t// If no URL is set and we have a clipboard URL let's use it\n\t\t\t\tif ( ! activeAttributes.url && this.state.clipboardURL ) {\n\t\t\t\t\tactiveAttributes.url = this.state.clipboardURL;\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<ModalLinkUI\n\t\t\t\t\t\t\tisVisible={ this.state.addingLink }\n\t\t\t\t\t\t\tisActive={ isActive }\n\t\t\t\t\t\t\tactiveAttributes={ activeAttributes }\n\t\t\t\t\t\t\tonClose={ this.stopAddingLink }\n\t\t\t\t\t\t\tonChange={ onChange }\n\t\t\t\t\t\t\tonRemove={ this.onRemoveFormat }\n\t\t\t\t\t\t\tvalue={ linkSelection }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<RichTextToolbarButton\n\t\t\t\t\t\t\tname=\"link\"\n\t\t\t\t\t\t\ticon={ linkIcon }\n\t\t\t\t\t\t\ttitle={ __( 'Link' ) }\n\t\t\t\t\t\t\tonClick={ this.addLink }\n\t\t\t\t\t\t\tisActive={ isActive }\n\t\t\t\t\t\t\tshortcutType=\"primary\"\n\t\t\t\t\t\t\tshortcutCharacter=\"k\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t),\n};\n"]}