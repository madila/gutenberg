{"version":3,"sources":["@wordpress/components/src/mobile/image/index.native.js"],"names":["ICON_TYPE","PLACEHOLDER","RETRY","UPLOAD","editImageComponent","open","mediaOptions","styles","editContainer","edit","SvgIconCustomize","iconCustomise","ImageComponent","align","alt","isSelected","isUploadFailed","isUploadInProgress","onSelectMediaUploadOption","openMediaOptions","retryMessage","url","imageWidth","width","focalPoint","imageData","setImageData","containerSize","setContainerSize","Image","getSize","imgWidth","imgHeight","aspectRatio","height","onContainerLayout","event","nativeEvent","layout","getIcon","iconType","iconStyle","SvgIconRetry","iconRetry","iconPlaceholderStyles","iconUploadStyles","icon","iconPlaceholder","iconPlaceholderDark","iconUpload","iconUploadDark","placeholderStyles","imageContainerUpload","imageContainerUploadDark","customWidth","imageContainerStyles","imageContent","focalPointContainer","imageStyles","opacity","undefined","container","alignItems","imageBorder","imageUploadingIconContainer","focalPointContent","uri","resizeMethod","imageContainer","retryContainer","modalIcon","uploadFailedText"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { Image, Text, TouchableWithoutFeedback, View } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Icon } from '@wordpress/components';\nimport { image as icon } from '@wordpress/icons';\nimport { usePreferredColorSchemeStyle } from '@wordpress/compose';\nimport { useEffect, useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { MediaEdit } from '../media-edit';\nimport { getImageWithFocalPointStyles } from '../image-with-focalpoint';\nimport styles from './style.scss';\nimport SvgIconRetry from './icon-retry';\nimport SvgIconCustomize from './icon-customize';\n\nconst ICON_TYPE = {\n\tPLACEHOLDER: 'placeholder',\n\tRETRY: 'retry',\n\tUPLOAD: 'upload',\n};\n\nfunction editImageComponent( { open, mediaOptions } ) {\n\treturn (\n\t\t<TouchableWithoutFeedback onPress={ open }>\n\t\t\t<View style={ styles.editContainer }>\n\t\t\t\t<View style={ styles.edit }>\n\t\t\t\t\t{ mediaOptions() }\n\t\t\t\t\t<Icon\n\t\t\t\t\t\tsize={ 16 }\n\t\t\t\t\t\ticon={ SvgIconCustomize }\n\t\t\t\t\t\t{ ...styles.iconCustomise }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</View>\n\t\t</TouchableWithoutFeedback>\n\t);\n}\n\nconst ImageComponent = ( {\n\talign,\n\talt,\n\tisSelected,\n\tisUploadFailed,\n\tisUploadInProgress,\n\tonSelectMediaUploadOption,\n\topenMediaOptions,\n\tretryMessage,\n\turl,\n\twidth: imageWidth,\n\tfocalPoint,\n} ) => {\n\tconst [ imageData, setImageData ] = useState( null );\n\tconst [ containerSize, setContainerSize ] = useState( null );\n\n\tuseEffect( () => {\n\t\tif ( url ) {\n\t\t\tImage.getSize( url, ( imgWidth, imgHeight ) => {\n\t\t\t\tsetImageData( {\n\t\t\t\t\taspectRatio: imgWidth / imgHeight,\n\t\t\t\t\twidth: imgWidth,\n\t\t\t\t\theight: imgHeight,\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t}, [ url ] );\n\n\tconst onContainerLayout = ( event ) => {\n\t\tconst { height, width } = event.nativeEvent.layout;\n\n\t\tif (\n\t\t\twidth !== 0 &&\n\t\t\theight !== 0 &&\n\t\t\t( containerSize?.width !== width ||\n\t\t\t\tcontainerSize?.height !== height )\n\t\t) {\n\t\t\tsetContainerSize( { width, height } );\n\t\t}\n\t};\n\n\tconst getIcon = ( iconType ) => {\n\t\tlet iconStyle;\n\t\tswitch ( iconType ) {\n\t\t\tcase ICON_TYPE.RETRY:\n\t\t\t\treturn <Icon icon={ SvgIconRetry } { ...styles.iconRetry } />;\n\t\t\tcase ICON_TYPE.PLACEHOLDER:\n\t\t\t\ticonStyle = iconPlaceholderStyles;\n\t\t\t\tbreak;\n\t\t\tcase ICON_TYPE.UPLOAD:\n\t\t\t\ticonStyle = iconUploadStyles;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn <Icon icon={ icon } { ...iconStyle } />;\n\t};\n\n\tconst iconPlaceholderStyles = usePreferredColorSchemeStyle(\n\t\tstyles.iconPlaceholder,\n\t\tstyles.iconPlaceholderDark\n\t);\n\n\tconst iconUploadStyles = usePreferredColorSchemeStyle(\n\t\tstyles.iconUpload,\n\t\tstyles.iconUploadDark\n\t);\n\n\tconst placeholderStyles = usePreferredColorSchemeStyle(\n\t\tstyles.imageContainerUpload,\n\t\tstyles.imageContainerUploadDark\n\t);\n\n\tconst customWidth =\n\t\timageData?.width < containerSize?.width ? imageData?.width : '100%';\n\n\tconst imageContainerStyles = [\n\t\tstyles.imageContent,\n\t\t{\n\t\t\twidth:\n\t\t\t\timageData && imageWidth > 0 && imageWidth < containerSize?.width\n\t\t\t\t\t? imageWidth\n\t\t\t\t\t: customWidth,\n\t\t},\n\t\tfocalPoint && styles.focalPointContainer,\n\t];\n\n\tconst imageStyles = [\n\t\t{\n\t\t\topacity: isUploadInProgress ? 0.3 : 1,\n\t\t\theight: containerSize?.height,\n\t\t},\n\t\tfocalPoint && styles.focalPoint,\n\t\tfocalPoint &&\n\t\t\tgetImageWithFocalPointStyles(\n\t\t\t\tfocalPoint,\n\t\t\t\tcontainerSize,\n\t\t\t\timageData\n\t\t\t),\n\t\t! focalPoint &&\n\t\t\timageData &&\n\t\t\tcontainerSize && {\n\t\t\t\theight:\n\t\t\t\t\timageData?.width > containerSize?.width\n\t\t\t\t\t\t? containerSize?.width / imageData?.aspectRatio\n\t\t\t\t\t\t: undefined,\n\t\t\t},\n\t];\n\n\treturn (\n\t\t<View\n\t\t\tstyle={ [\n\t\t\t\tstyles.container,\n\t\t\t\t// only set alignItems if an image exists because alignItems causes the placeholder\n\t\t\t\t// to disappear when an aligned image can't be downloaded\n\t\t\t\t// https://github.com/wordpress-mobile/gutenberg-mobile/issues/1592\n\t\t\t\timageData && align && { alignItems: align },\n\t\t\t] }\n\t\t\tonLayout={ onContainerLayout }\n\t\t>\n\t\t\t<View\n\t\t\t\taccessible\n\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\taccessibilityLabel={ alt }\n\t\t\t\taccessibilityHint={ __( 'Double tap and hold to edit' ) }\n\t\t\t\taccessibilityRole={ 'imagebutton' }\n\t\t\t\tkey={ url }\n\t\t\t\tstyle={ imageContainerStyles }\n\t\t\t>\n\t\t\t\t{ isSelected && ! ( isUploadInProgress || isUploadFailed ) && (\n\t\t\t\t\t<View\n\t\t\t\t\t\tstyle={ [\n\t\t\t\t\t\t\tstyles.imageBorder,\n\t\t\t\t\t\t\t{ height: containerSize?.height },\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\n\t\t\t\t{ ! imageData ? (\n\t\t\t\t\t<View style={ placeholderStyles }>\n\t\t\t\t\t\t<View style={ styles.imageUploadingIconContainer }>\n\t\t\t\t\t\t\t{ getIcon( ICON_TYPE.UPLOAD ) }\n\t\t\t\t\t\t</View>\n\t\t\t\t\t</View>\n\t\t\t\t) : (\n\t\t\t\t\t<View style={ focalPoint && styles.focalPointContent }>\n\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\taspectRatio={ imageData?.aspectRatio }\n\t\t\t\t\t\t\tstyle={ imageStyles }\n\t\t\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t\t\t{ ...( ! focalPoint && { resizeMethod: 'scale' } ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\n\t\t\t\t{ isUploadFailed && (\n\t\t\t\t\t<View\n\t\t\t\t\t\tstyle={ [\n\t\t\t\t\t\t\tstyles.imageContainer,\n\t\t\t\t\t\t\tstyles.retryContainer,\n\t\t\t\t\t\t] }\n\t\t\t\t\t>\n\t\t\t\t\t\t<View style={ styles.modalIcon }>\n\t\t\t\t\t\t\t{ getIcon( ICON_TYPE.RETRY ) }\n\t\t\t\t\t\t</View>\n\t\t\t\t\t\t<Text style={ styles.uploadFailedText }>\n\t\t\t\t\t\t\t{ retryMessage }\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\t\t\t\t{ isSelected &&\n\t\t\t\t\t! isUploadInProgress &&\n\t\t\t\t\t! isUploadFailed &&\n\t\t\t\t\t( imageData || focalPoint ) && (\n\t\t\t\t\t\t<MediaEdit\n\t\t\t\t\t\t\tonSelect={ onSelectMediaUploadOption }\n\t\t\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t\t\topenReplaceMediaOptions={ openMediaOptions }\n\t\t\t\t\t\t\trender={ editImageComponent }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t</View>\n\t\t</View>\n\t);\n};\n\nexport default ImageComponent;\n"]}