{"version":3,"sources":["@wordpress/components/src/mobile/image-with-focalpoint/index.native.js"],"names":["getFocalPointOffset","imageRatio","container","imageSize","focusPoint","containerCenter","Math","floor","scaledImage","focus","focusOffset","offsetRest","containerRest","getImageWithFocalPointStyles","focalPoint","containerSize","originalImageData","imageStyle","horizontalOffset","verticalOffset","widthRatio","width","heightRatio","height","resizeMode","x","undefined","left","y","top","ImageWithFocalPoint","url","setOriginalImageData","setContainerSize","Image","getSize","aspectRatio","onContainerLayout","event","nativeEvent","layout","styles","image","uri"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { Image, View } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useEffect, memo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport styles from './style.scss';\n\nfunction getFocalPointOffset( imageRatio, container, imageSize, focusPoint ) {\n\tconst containerCenter = Math.floor( container / 2 );\n\tconst scaledImage = Math.floor( imageSize / imageRatio );\n\tconst focus = Math.floor( focusPoint * scaledImage );\n\tlet focusOffset = focus - containerCenter;\n\tconst offsetRest = scaledImage - focus;\n\tconst containerRest = container - containerCenter;\n\n\tif ( offsetRest < containerRest ) {\n\t\tfocusOffset -= containerRest - offsetRest;\n\t}\n\n\tif ( focusOffset < 0 ) {\n\t\tfocusOffset = 0;\n\t}\n\n\treturn -focusOffset;\n}\n\nexport function getImageWithFocalPointStyles(\n\tfocalPoint,\n\tcontainerSize,\n\toriginalImageData\n) {\n\tconst imageStyle = {};\n\tif ( focalPoint && containerSize && originalImageData ) {\n\t\tlet horizontalOffset = 0;\n\t\tlet verticalOffset = 0;\n\t\tconst widthRatio = originalImageData.width / containerSize.width;\n\t\tconst heightRatio = originalImageData.height / containerSize.height;\n\n\t\timageStyle.resizeMode = 'stretch';\n\n\t\tif ( widthRatio > heightRatio ) {\n\t\t\thorizontalOffset = getFocalPointOffset(\n\t\t\t\theightRatio,\n\t\t\t\tcontainerSize.width,\n\t\t\t\toriginalImageData.width,\n\t\t\t\tfocalPoint.x\n\t\t\t);\n\t\t\timageStyle.width = undefined;\n\t\t\timageStyle.left = horizontalOffset;\n\t\t} else if ( widthRatio < heightRatio ) {\n\t\t\tverticalOffset = getFocalPointOffset(\n\t\t\t\twidthRatio,\n\t\t\t\tcontainerSize.height,\n\t\t\t\toriginalImageData.height,\n\t\t\t\tfocalPoint.y\n\t\t\t);\n\t\t\timageStyle.height = undefined;\n\t\t\timageStyle.top = verticalOffset;\n\t\t}\n\n\t\treturn imageStyle;\n\t}\n\n\treturn imageStyle;\n}\n\nconst ImageWithFocalPoint = ( { focalPoint, url } ) => {\n\tconst [ originalImageData, setOriginalImageData ] = useState( null );\n\tconst [ containerSize, setContainerSize ] = useState( null );\n\n\tuseEffect( () => {\n\t\tif ( url ) {\n\t\t\tImage.getSize( url, ( width, height ) => {\n\t\t\t\tsetOriginalImageData( {\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\taspectRatio: width / height,\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t}, [ url ] );\n\n\tconst onContainerLayout = ( event ) => {\n\t\tconst { height, width } = event.nativeEvent.layout;\n\t\tsetContainerSize( { width, height } );\n\t};\n\n\treturn (\n\t\t<View style={ styles.container } onLayout={ onContainerLayout }>\n\t\t\t<Image\n\t\t\t\taspectRatio={ originalImageData?.aspectRatio }\n\t\t\t\tstyle={ [\n\t\t\t\t\tstyles.image,\n\t\t\t\t\t{ height: containerSize?.height },\n\t\t\t\t\tgetImageWithFocalPointStyles(\n\t\t\t\t\t\tfocalPoint,\n\t\t\t\t\t\tcontainerSize,\n\t\t\t\t\t\toriginalImageData\n\t\t\t\t\t),\n\t\t\t\t] }\n\t\t\t\tsource={ { uri: url } }\n\t\t\t/>\n\t\t</View>\n\t);\n};\n\nexport default memo( ImageWithFocalPoint );\n"]}