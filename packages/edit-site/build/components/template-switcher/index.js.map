{"version":3,"sources":["@wordpress/edit-site/src/components/template-switcher/index.js"],"names":["TEMPLATE_OVERRIDES","page","slug","category","post","TemplateLabel","template","homeId","id","home","status","TemplateSwitcher","activeId","activeTemplatePartId","isTemplatePart","onActiveIdChange","onActiveTemplatePartIdChange","onAddTemplate","onRemoveTemplate","hoveredTemplate","setHoveredTemplate","themePreviewVisible","setThemePreviewVisible","onHoverTemplatePart","type","onMouseEnterTheme","onMouseLeaveTheme","registry","setHomeId","__experimentalResolveSelect","getEntityRecords","then","newHomeId","select","getCurrentTheme","getEntityRecord","_template","currentTheme","templateParts","resolved","templateItem","label","value","content","templatePartItems","map","templatePart","overwriteSlug","overwriteTemplate","title","raw","revertToParent","className","position","children","find","choice","plus","undo","undefined","name"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useRegistry, useSelect } from '@wordpress/data';\nimport { useEffect, useState } from '@wordpress/element';\nimport {\n\tTooltip,\n\tDropdownMenu,\n\tMenuGroup,\n\tMenuItemsChoice,\n\tMenuItem,\n} from '@wordpress/components';\nimport { Icon, home, plus, undo } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { findTemplate } from '../../utils';\nimport TemplatePreview from './template-preview';\nimport ThemePreview from './theme-preview';\n\nconst TEMPLATE_OVERRIDES = {\n\tpage: ( slug ) => `page-${ slug }`,\n\tcategory: ( slug ) => `category-${ slug }`,\n\tpost: ( slug ) => `single-post-${ slug }`,\n};\n\nfunction TemplateLabel( { template, homeId } ) {\n\treturn (\n\t\t<>\n\t\t\t{ template.slug }{ ' ' }\n\t\t\t{ template.id === homeId && (\n\t\t\t\t<Tooltip text={ __( 'Home' ) }>\n\t\t\t\t\t<div className=\"edit-site-template-switcher__label-home-icon\">\n\t\t\t\t\t\t<Icon icon={ home } />\n\t\t\t\t\t</div>\n\t\t\t\t</Tooltip>\n\t\t\t) }\n\t\t\t{ template.status !== 'auto-draft' && (\n\t\t\t\t<Tooltip text={ __( 'Customized' ) }>\n\t\t\t\t\t<span className=\"edit-site-template-switcher__label-customized-dot\" />\n\t\t\t\t</Tooltip>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nexport default function TemplateSwitcher( {\n\tpage,\n\tactiveId,\n\tactiveTemplatePartId,\n\tisTemplatePart,\n\tonActiveIdChange,\n\tonActiveTemplatePartIdChange,\n\tonAddTemplate,\n\tonRemoveTemplate,\n} ) {\n\tconst [ hoveredTemplate, setHoveredTemplate ] = useState();\n\tconst [ themePreviewVisible, setThemePreviewVisible ] = useState( false );\n\n\tconst onHoverTemplatePart = ( id ) => {\n\t\tsetHoveredTemplate( { id, type: 'template-part' } );\n\t};\n\tconst onMouseEnterTheme = () => {\n\t\tsetThemePreviewVisible( () => true );\n\t};\n\tconst onMouseLeaveTheme = () => {\n\t\tsetThemePreviewVisible( () => false );\n\t};\n\n\tconst registry = useRegistry();\n\tconst [ homeId, setHomeId ] = useState();\n\n\tuseEffect( () => {\n\t\tfindTemplate(\n\t\t\t'/',\n\t\t\tregistry.__experimentalResolveSelect( 'core' ).getEntityRecords\n\t\t).then(\n\t\t\t( newHomeId ) => setHomeId( newHomeId ),\n\t\t\t() => setHomeId( null )\n\t\t);\n\t}, [ registry ] );\n\n\tconst { currentTheme, template, templateParts } = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetCurrentTheme,\n\t\t\t\tgetEntityRecord,\n\t\t\t\tgetEntityRecords,\n\t\t\t} = select( 'core' );\n\n\t\t\tconst _template = getEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\t'wp_template',\n\t\t\t\tactiveId\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\tcurrentTheme: getCurrentTheme(),\n\t\t\t\ttemplate: _template,\n\t\t\t\ttemplateParts: _template\n\t\t\t\t\t? getEntityRecords( 'postType', 'wp_template_part', {\n\t\t\t\t\t\t\tresolved: true,\n\t\t\t\t\t\t\ttemplate: _template.slug,\n\t\t\t\t\t  } )\n\t\t\t\t\t: null,\n\t\t\t};\n\t\t},\n\t\t[ activeId ]\n\t);\n\n\tconst templateItem = {\n\t\tlabel: template ? (\n\t\t\t<TemplateLabel template={ template } homeId={ homeId } />\n\t\t) : (\n\t\t\t__( 'Loading…' )\n\t\t),\n\t\tvalue: activeId,\n\t\tslug: template ? template.slug : __( 'Loading…' ),\n\t\tcontent: template?.content,\n\t};\n\n\tconst templatePartItems = templateParts?.map( ( templatePart ) => ( {\n\t\tlabel: <TemplateLabel template={ templatePart } />,\n\t\tvalue: templatePart.id,\n\t\tslug: templatePart.slug,\n\t} ) );\n\n\tconst overwriteSlug =\n\t\tTEMPLATE_OVERRIDES[ page.type ] &&\n\t\tpage.slug &&\n\t\tTEMPLATE_OVERRIDES[ page.type ]( page.slug );\n\tconst overwriteTemplate = () =>\n\t\tonAddTemplate( {\n\t\t\tslug: overwriteSlug,\n\t\t\ttitle: overwriteSlug,\n\t\t\tstatus: 'publish',\n\t\t\tcontent: templateItem.content.raw,\n\t\t} );\n\tconst revertToParent = async () => {\n\t\tonRemoveTemplate( activeId );\n\t};\n\treturn (\n\t\t<>\n\t\t\t<DropdownMenu\n\t\t\t\tpopoverProps={ {\n\t\t\t\t\tclassName: 'edit-site-template-switcher__popover',\n\t\t\t\t\tposition: 'bottom right',\n\t\t\t\t} }\n\t\t\t\ticon={ null }\n\t\t\t\tlabel={ __( 'Switch Template' ) }\n\t\t\t\ttoggleProps={ {\n\t\t\t\t\tchildren: ( isTemplatePart\n\t\t\t\t\t\t? templatePartItems\n\t\t\t\t\t\t: [ templateItem ]\n\t\t\t\t\t).find(\n\t\t\t\t\t\t( choice ) =>\n\t\t\t\t\t\t\tchoice.value ===\n\t\t\t\t\t\t\t( isTemplatePart ? activeTemplatePartId : activeId )\n\t\t\t\t\t).slug,\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t{ () => (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<MenuGroup label={ __( 'Template' ) }>\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\tonClick={ () => onActiveIdChange( activeId ) }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ templateItem.label }\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t{ overwriteSlug &&\n\t\t\t\t\t\t\t\toverwriteSlug !== templateItem.slug && (\n\t\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\t\ticon={ plus }\n\t\t\t\t\t\t\t\t\t\tonClick={ overwriteTemplate }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ __( 'Overwrite Template' ) }\n\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t{ overwriteSlug === templateItem.slug && (\n\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\ticon={ undo }\n\t\t\t\t\t\t\t\t\tonClick={ revertToParent }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __( 'Revert to Parent' ) }\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</MenuGroup>\n\t\t\t\t\t\t<MenuGroup label={ __( 'Template Parts' ) }>\n\t\t\t\t\t\t\t<MenuItemsChoice\n\t\t\t\t\t\t\t\tchoices={ templatePartItems }\n\t\t\t\t\t\t\t\tvalue={\n\t\t\t\t\t\t\t\t\tisTemplatePart\n\t\t\t\t\t\t\t\t\t\t? activeTemplatePartId\n\t\t\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tonSelect={ onActiveTemplatePartIdChange }\n\t\t\t\t\t\t\t\tonHover={ onHoverTemplatePart }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</MenuGroup>\n\t\t\t\t\t\t<MenuGroup label={ __( 'Current theme' ) }>\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\tonMouseEnter={ onMouseEnterTheme }\n\t\t\t\t\t\t\t\tonMouseLeave={ onMouseLeaveTheme }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ currentTheme.name.raw }\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t</MenuGroup>\n\t\t\t\t\t\t{ !! hoveredTemplate?.id && (\n\t\t\t\t\t\t\t<TemplatePreview item={ hoveredTemplate } />\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t{ themePreviewVisible && (\n\t\t\t\t\t\t\t<ThemePreview theme={ currentTheme } />\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t<div className=\"edit-site-template-switcher__footer\" />\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</DropdownMenu>\n\t\t</>\n\t);\n}\n"]}