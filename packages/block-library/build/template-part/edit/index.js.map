{"version":3,"sources":["@wordpress/block-library/src/template-part/edit/index.js"],"names":["TemplatePartEdit","attributes","_postId","postId","slug","theme","setAttributes","clientId","isSelected","initialPostId","initialSlug","initialTheme","select","getBlocks","getHasSelectedInnerBlock","hasSelectedInnerBlock","innerBlocks","editEntityRecord","blockChanges","current","undefined","status","length"],"mappings":";;;;;;;;;AAGA;;AACA;;AAKA;;AACA;;AACA;;AACA;;AAZA;;;;AAMA;;;AAQe,SAASA,gBAAT,OAKX;AAAA,6BAJHC,UAIG;AAAA,MAJmBC,OAInB,mBAJWC,MAIX;AAAA,MAJ4BC,IAI5B,mBAJ4BA,IAI5B;AAAA,MAJkCC,KAIlC,mBAJkCA,KAIlC;AAAA,MAHHC,aAGG,QAHHA,aAGG;AAAA,MAFHC,QAEG,QAFHA,QAEG;AAAA,MADHC,UACG,QADHA,UACG;AACH,MAAMC,aAAa,GAAG,qBAAQP,OAAR,CAAtB;AACA,MAAMQ,WAAW,GAAG,qBAAQN,IAAR,CAApB;AACA,MAAMO,YAAY,GAAG,qBAAQN,KAAR,CAArB,CAHG,CAKH;;AACA,MAAMF,MAAM,GAAG,kCAAqBD,OAArB,EAA8BE,IAA9B,EAAoCC,KAApC,CAAf,CANG,CAQH;AACA;AACA;AACA;;AAXG,mBAY4C,qBAC9C,UAAEO,MAAF,EAAc;AAAA,kBAITA,MAAM,CAAE,mBAAF,CAJG;AAAA,QAEZC,SAFY,WAEZA,SAFY;AAAA,QAGWC,wBAHX,WAGZC,qBAHY;;AAKb,WAAO;AACNC,MAAAA,WAAW,EAAEH,SAAS,CAAEN,QAAF,CADhB;AAENQ,MAAAA,qBAAqB,EAAED,wBAAwB,CAC9CP,QAD8C,EAE9C,IAF8C;AAFzC,KAAP;AAOA,GAb6C,EAc9C,CAAEA,QAAF,CAd8C,CAZ5C;AAAA,MAYKS,WAZL,cAYKA,WAZL;AAAA,MAYkBD,qBAZlB,cAYkBA,qBAZlB;;AAAA,qBA4B0B,uBAAa,MAAb,CA5B1B;AAAA,MA4BKE,gBA5BL,gBA4BKA,gBA5BL;;AA6BH,MAAMC,YAAY,GAAG,qBAAQ,CAAR,CAArB;AACA,0BAAW,YAAM;AAChB,QAAKA,YAAY,CAACC,OAAb,GAAuB,CAA5B,EAAgCD,YAAY,CAACC,OAAb;;AAEhC,QACCD,YAAY,CAACC,OAAb,KAAyB,CAAzB,KACEV,aAAa,CAACU,OAAd,KAA0BC,SAA1B,IACDX,aAAa,CAACU,OAAd,KAA0B,IAF3B,KAGAhB,MAAM,KAAKiB,SAHX,IAIAjB,MAAM,KAAK,IALZ,EAME;AACDG,MAAAA,aAAa,CAAE;AAAEH,QAAAA,MAAM,EAANA;AAAF,OAAF,CAAb;AACAc,MAAAA,gBAAgB,CAAE,UAAF,EAAc,kBAAd,EAAkCd,MAAlC,EAA0C;AACzDkB,QAAAA,MAAM,EAAE;AADiD,OAA1C,CAAhB;AAGA;AACD,GAfD,EAeG,CAAEL,WAAF,CAfH;;AAiBA,MAAKb,MAAL,EAAc;AACb;AACA,WACC,qDACG,CAAEK,UAAU,IAAIO,qBAAhB,KACD,4BAAC,kBAAD;AACC,MAAA,MAAM,EAAGZ,MADV;AAEC,MAAA,aAAa,EAAGG;AAFjB,MAFF,EAOC,4BAAC,oBAAD;AACC,MAAA,MAAM,EAAGH,MADV;AAEC,MAAA,cAAc,EAAGa,WAAW,CAACM,MAAZ,GAAqB;AAFvC,MAPD,CADD;AAcA;;AACD,MAAK,CAAEZ,WAAW,CAACS,OAAd,IAAyB,CAAER,YAAY,CAACQ,OAA7C,EAAuD;AACtD;AACA,WAAO,4BAAC,oBAAD;AAAyB,MAAA,aAAa,EAAGb;AAAzC,MAAP;AACA,GAnEE,CAoEH;;;AACA,SAAO,IAAP;AACA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef, useEffect } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport useTemplatePartPost from './use-template-part-post';\nimport TemplatePartNamePanel from './name-panel';\nimport TemplatePartInnerBlocks from './inner-blocks';\nimport TemplatePartPlaceholder from './placeholder';\n\nexport default function TemplatePartEdit( {\n\tattributes: { postId: _postId, slug, theme },\n\tsetAttributes,\n\tclientId,\n\tisSelected,\n} ) {\n\tconst initialPostId = useRef( _postId );\n\tconst initialSlug = useRef( slug );\n\tconst initialTheme = useRef( theme );\n\n\t// Resolve the post ID if not set, and load its post.\n\tconst postId = useTemplatePartPost( _postId, slug, theme );\n\n\t// Set the post ID, once found, so that edits persist,\n\t// but wait until the third inner blocks change,\n\t// because the first 2 are just the template part\n\t// content loading.\n\tconst { innerBlocks, hasSelectedInnerBlock } = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlocks,\n\t\t\t\thasSelectedInnerBlock: getHasSelectedInnerBlock,\n\t\t\t} = select( 'core/block-editor' );\n\t\t\treturn {\n\t\t\t\tinnerBlocks: getBlocks( clientId ),\n\t\t\t\thasSelectedInnerBlock: getHasSelectedInnerBlock(\n\t\t\t\t\tclientId,\n\t\t\t\t\ttrue\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\tconst { editEntityRecord } = useDispatch( 'core' );\n\tconst blockChanges = useRef( 0 );\n\tuseEffect( () => {\n\t\tif ( blockChanges.current < 4 ) blockChanges.current++;\n\n\t\tif (\n\t\t\tblockChanges.current === 3 &&\n\t\t\t( initialPostId.current === undefined ||\n\t\t\t\tinitialPostId.current === null ) &&\n\t\t\tpostId !== undefined &&\n\t\t\tpostId !== null\n\t\t) {\n\t\t\tsetAttributes( { postId } );\n\t\t\teditEntityRecord( 'postType', 'wp_template_part', postId, {\n\t\t\t\tstatus: 'publish',\n\t\t\t} );\n\t\t}\n\t}, [ innerBlocks ] );\n\n\tif ( postId ) {\n\t\t// Part of a template file, post ID already resolved.\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ ( isSelected || hasSelectedInnerBlock ) && (\n\t\t\t\t\t<TemplatePartNamePanel\n\t\t\t\t\t\tpostId={ postId }\n\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t<TemplatePartInnerBlocks\n\t\t\t\t\tpostId={ postId }\n\t\t\t\t\thasInnerBlocks={ innerBlocks.length > 0 }\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t}\n\tif ( ! initialSlug.current && ! initialTheme.current ) {\n\t\t// Fresh new block.\n\t\treturn <TemplatePartPlaceholder setAttributes={ setAttributes } />;\n\t}\n\t// Part of a template file, post ID not resolved yet.\n\treturn null;\n}\n"]}