{"version":3,"sources":["@wordpress/block-library/src/post-author/edit.js"],"names":["DEFAULT_CONTRAST_CHECK_FONT_SIZE","PostAuthorEdit","isSelected","context","attributes","setAttributes","postType","postId","select","getEditedEntityRecord","getUser","getAuthors","_authorId","author","authorId","authorDetails","authors","editEntityRecord","getSettings","fontSizes","fontSizeIndex","contrastCheckFontSize","style","typography","fontSize","size","ref","name","property","className","contrastCheckers","backgroundColor","textColor","colorDetector","targetRef","colorPanelProps","initialOpen","TextColor","BackgroundColor","InspectorControlsColorPanel","ColorPanel","align","showAvatar","showBio","byline","avatarSizes","avatar_urls","url","push","value","label","classNames","block","map","id","nextAuthorId","avatarSize","Number","nextAlign","RichText","isEmpty","description"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { forEach, groupBy } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useRef, useMemo } from '@wordpress/element';\nimport {\n\tAlignmentToolbar,\n\tBlockControls,\n\tInspectorControls,\n\tRichText,\n\t__experimentalUseColors,\n\tBlockColorsStyleSelector,\n} from '@wordpress/block-editor';\nimport { PanelBody, SelectControl, ToggleControl } from '@wordpress/components';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\n\nconst DEFAULT_CONTRAST_CHECK_FONT_SIZE = 12;\n\nfunction PostAuthorEdit( { isSelected, context, attributes, setAttributes } ) {\n\tconst { postType, postId } = context;\n\n\tconst { authorId, authorDetails, authors } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEditedEntityRecord, getUser, getAuthors } = select(\n\t\t\t\t'core'\n\t\t\t);\n\t\t\tconst _authorId = getEditedEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\tpostType,\n\t\t\t\tpostId\n\t\t\t)?.author;\n\n\t\t\treturn {\n\t\t\t\tauthorId: _authorId,\n\t\t\t\tauthorDetails: _authorId ? getUser( _authorId ) : null,\n\t\t\t\tauthors: getAuthors(),\n\t\t\t};\n\t\t},\n\t\t[ postType, postId ]\n\t);\n\n\tconst { editEntityRecord } = useDispatch( 'core' );\n\n\t// Need font size in number form for named presets to be used in contrastCheckers.\n\tconst { fontSizes } = useSelect( ( select ) =>\n\t\tselect( 'core/block-editor' ).getSettings()\n\t);\n\tconst fontSizeIndex = useMemo( () => groupBy( fontSizes, 'slug' ), [\n\t\tfontSizes,\n\t] );\n\tconst contrastCheckFontSize = useMemo(\n\t\t() =>\n\t\t\t// Custom size if set.\n\t\t\tattributes.style?.typography?.fontSize ||\n\t\t\t// Size of preset/named value if set.\n\t\t\tfontSizeIndex[ attributes.fontSize ]?.[ 0 ].size ||\n\t\t\tDEFAULT_CONTRAST_CHECK_FONT_SIZE,\n\t\t[\n\t\t\tattributes.style?.typography?.fontSize,\n\t\t\tattributes.fontSize,\n\t\t\tfontSizeIndex,\n\t\t]\n\t);\n\tconst ref = useRef();\n\tconst {\n\t\tTextColor,\n\t\tBackgroundColor,\n\t\tInspectorControlsColorPanel,\n\t\tColorPanel,\n\t} = __experimentalUseColors(\n\t\t[\n\t\t\t{ name: 'textColor', property: 'color' },\n\t\t\t{ name: 'backgroundColor', className: 'background-color' },\n\t\t],\n\t\t{\n\t\t\tcontrastCheckers: [\n\t\t\t\t{\n\t\t\t\t\tbackgroundColor: true,\n\t\t\t\t\ttextColor: true,\n\t\t\t\t\tfontSize: contrastCheckFontSize,\n\t\t\t\t},\n\t\t\t],\n\t\t\tcolorDetector: { targetRef: ref },\n\t\t\tcolorPanelProps: {\n\t\t\t\tinitialOpen: true,\n\t\t\t},\n\t\t},\n\t\t[ contrastCheckFontSize ]\n\t);\n\n\tconst { align, showAvatar, showBio, byline } = attributes;\n\n\tconst avatarSizes = [];\n\tif ( authorDetails ) {\n\t\tforEach( authorDetails.avatar_urls, ( url, size ) => {\n\t\t\tavatarSizes.push( {\n\t\t\t\tvalue: size,\n\t\t\t\tlabel: `${ size } x ${ size }`,\n\t\t\t} );\n\t\t} );\n\t}\n\n\tconst classNames = useMemo( () => {\n\t\treturn {\n\t\t\tblock: classnames( 'wp-block-post-author', {\n\t\t\t\t[ `has-text-align-${ align }` ]: align,\n\t\t\t} ),\n\t\t};\n\t}, [ align ] );\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Author Settings' ) }>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Author' ) }\n\t\t\t\t\t\tvalue={ authorId }\n\t\t\t\t\t\toptions={ authors.map( ( { id, name } ) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tvalue: id,\n\t\t\t\t\t\t\t\tlabel: name,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} ) }\n\t\t\t\t\t\tonChange={ ( nextAuthorId ) => {\n\t\t\t\t\t\t\teditEntityRecord( 'postType', postType, postId, {\n\t\t\t\t\t\t\t\tauthor: nextAuthorId,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Show avatar' ) }\n\t\t\t\t\t\tchecked={ showAvatar }\n\t\t\t\t\t\tonChange={ () =>\n\t\t\t\t\t\t\tsetAttributes( { showAvatar: ! showAvatar } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t\t{ showAvatar && (\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Avatar size' ) }\n\t\t\t\t\t\t\tvalue={ attributes.avatarSize }\n\t\t\t\t\t\t\toptions={ avatarSizes }\n\t\t\t\t\t\t\tonChange={ ( size ) => {\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tavatarSize: Number( size ),\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Show bio' ) }\n\t\t\t\t\t\tchecked={ showBio }\n\t\t\t\t\t\tonChange={ () =>\n\t\t\t\t\t\t\tsetAttributes( { showBio: ! showBio } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\n\t\t\t{ InspectorControlsColorPanel }\n\n\t\t\t<BlockControls>\n\t\t\t\t<AlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ ( nextAlign ) => {\n\t\t\t\t\t\tsetAttributes( { align: nextAlign } );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t\t<BlockColorsStyleSelector\n\t\t\t\t\tTextColor={ TextColor }\n\t\t\t\t\tBackgroundColor={ BackgroundColor }\n\t\t\t\t>\n\t\t\t\t\t{ ColorPanel }\n\t\t\t\t</BlockColorsStyleSelector>\n\t\t\t</BlockControls>\n\n\t\t\t<TextColor>\n\t\t\t\t<BackgroundColor>\n\t\t\t\t\t<div ref={ ref } className={ classNames.block }>\n\t\t\t\t\t\t{ showAvatar && authorDetails && (\n\t\t\t\t\t\t\t<div className=\"wp-block-post-author__avatar\">\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\twidth={ attributes.avatarSize }\n\t\t\t\t\t\t\t\t\tsrc={\n\t\t\t\t\t\t\t\t\t\tauthorDetails.avatar_urls[\n\t\t\t\t\t\t\t\t\t\t\tattributes.avatarSize\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\talt={ authorDetails.name }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t<div className=\"wp-block-post-author__content\">\n\t\t\t\t\t\t\t{ ( ! RichText.isEmpty( byline ) ||\n\t\t\t\t\t\t\t\tisSelected ) && (\n\t\t\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\t\t\tclassName=\"wp-block-post-author__byline\"\n\t\t\t\t\t\t\t\t\tmultiline={ false }\n\t\t\t\t\t\t\t\t\tplaceholder={ __( 'Write byline …' ) }\n\t\t\t\t\t\t\t\t\tvalue={ byline }\n\t\t\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\t\t\tsetAttributes( { byline: value } )\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t<p className=\"wp-block-post-author__name\">\n\t\t\t\t\t\t\t\t{ authorDetails?.name || __( 'Post Author' ) }\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{ showBio && (\n\t\t\t\t\t\t\t\t<p className=\"wp-block-post-author__bio\">\n\t\t\t\t\t\t\t\t\t{ authorDetails?.description }\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</BackgroundColor>\n\t\t\t</TextColor>\n\t\t</>\n\t);\n}\n\nexport default PostAuthorEdit;\n"]}